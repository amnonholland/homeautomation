
<!DOCTYPE HTML>
<html style="overflow: hidden">
<body style="background-color:black;">
<head>


<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style"content="default" />
<meta name="viewport" content="initial-scale=1.0,user-scalable=no, width=device-width" />
<meta http-equiv="expires" content="0">
<style>
html {
 
 
}

</style>

<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script></head>
<body>
<div id="chartContainer" style="height: 300px; width: 100%;">
</div>
<br>

  <label for="item"style="color:#DDDF0E;"></label>
  <select onchange="trend1();render();" name="item" style="color:#DDDF0E;background-color:#424949;" id="item">
    <option value="analog-input/101">analog-input/101 - OAT</option>
    <option value="analog-input/102">analog-input/102 - Lounge T</option>
    <option value="analog-input/103">analog-input/103 - Batt A</option>
    <option value="analog-input/104">analog-input/104 - Master T</option>
    <option value="analog-input/105">analog-input/105 - DHW T</option>
    <option value="analog-input/106">analog-input/106 - Batt V</option>
    <option value="analog-input/107">analog-input/107 - House Tank</option>
    <option value="analog-input/108">analog-input/108 - Irrig. Tank</option>
    <option value="binary-output/102">binary-output/102 - DHW Booster</option>
    <option value="binary-output/103">binary-output/103 - Batt Grid Connect</option>
    <option value="binary-output/104">binary-output/104 - DHW Boost</option>
    <option value="analog-value/5">analog-value/5 - Circ</option>
    <option value="analog-value/22">analog-value/22 - Solar V</option>
    <option value="analog-value/28">analog-value/28 - Solar kWh/day</option>
    <option value="analog-value/43">analog-value/43 - Temp 1</option>
    <option value="analog-value/44">analog-value/44 - RH 1</option>
    <option value="analog-value/45">analog-value/45 - Temp 2</option>
    <option value="analog-value/46">analog-value/46 - RH 2</option>
    <option value="analog-value/48">analog-value/48 - Batt kW</option>
  </select>
 
  &emsp;
    <label for="item1"style="color:#7698BF;"></label>
  <select onchange="trend2();render();" name="item1" id="item1"style="color:#7698BF;background-color:#424949;">
    <option value="analog-input/101">analog-input/101 - OAT</option>
    <option value="analog-input/102">analog-input/102 - Lounge T</option>
    <option value="analog-input/103">analog-input/103 - Batt A</option>
    <option value="analog-input/104">analog-input/104 - Master T</option>
    <option value="analog-input/105">analog-input/105 - DHW T</option>
    <option value="analog-input/106">analog-input/106 - Batt V</option>
    <option value="analog-input/107">analog-input/107 - House Tank</option>
    <option value="analog-input/108">analog-input/108 - Irrig. Tank</option>
    <option value="binary-output/102">binary-output/102 - DHW Booster</option>
    <option value="binary-output/103">binary-output/103 - Batt Grid Connect</option>
    <option value="binary-output/104">binary-output/104 - DHW Boost</option>
    <option value="analog-value/5">analog-value/5 - Circ</option>
    <option value="analog-value/22">analog-value/22 - Solar V</option>
    <option value="analog-value/28">analog-value/28 - Solar kWh/day</option>
    <option value="analog-value/43">analog-value/43 - Temp 1</option>
    <option value="analog-value/44">analog-value/44 - RH 1</option>
    <option value="analog-value/45">analog-value/45 - Temp 2</option>
    <option value="analog-value/46">analog-value/46 - RH 2</option>
    <option value="analog-value/48">analog-value/48 - Batt kW</option>
  </select>
  &emsp;
      <label for="item2"style="color:#c0504e;"></label>
  <select onchange="trend1();trend2();render()" name="item2" id="item2"style="color:#999999;background-color:#424949;">
    <option value="1">1 Day</option>
    <option value="2">2 Days</option>
    <option value="3">3 Days</option>
  </select>
 
 
 


<span id="hello"></span><Br><span id="hello1"></span><Br><span id="hello2"></span><Br><span id="hello3"></span><Br><span id="hello4"></span>

</body>
</html>
<script>

               
var dataSeries = {type: "line",xValueType: "dateTime",name: "Log 1"};
var data1Series = {type: "line",xValueType: "dateTime",name: "Log 2"};
var dataPoints = [];var data1Points = [];
var data = [];
var i=0;

trend1();trend2();render();

function trend1(){
i=0;dataPoints=[];
var item = document.getElementById("item").value;
var samples = document.getElementById("item2").value;

var URL = String("https://amnon.dyndns.org/api/rest/v1/protocols/bacnet/local/objects/")+item+String("/trend?encode=json&dataOnly=true&limit=")+samples*288+String("&descending=true");
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.open("GET", URL, false);
    xmlhttp.setRequestHeader("Content-Type", "application/json");
    xmlhttp.setRequestHeader('Authorization','Basic YWRtaW46U3luY2VsZWN0MjkxMQ==');
    xmlhttp.send(null);
var json = JSON.parse(xmlhttp.responseText);
var time = json.map(item => item.timeStamp);
var value = json.map(item => item.value);

if(item.includes("binary")){dataSeries.type = "stepArea"}
for (var i = 0; i < time.length; i ++) {dataPoints.push({x: time[i],y: value[i]});}
//dataSeries.dataPoints = dataPoints;data.push(dataSeries);
}



function trend2(){  
i=0;data1Points=[];
var item = document.getElementById("item1").value;
var samples = document.getElementById("item2").value;

var URL = String("https://amnon.dyndns.org/api/rest/v1/protocols/bacnet/local/objects/")+item+String("/trend?encode=json&dataOnly=true&limit=")+samples*288+String("&descending=true");
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.open("GET", URL, false);
    xmlhttp.setRequestHeader("Content-Type", "application/json");
    xmlhttp.setRequestHeader('Authorization','Basic YWRtaW46U3luY2VsZWN0MjkxMQ==');
    xmlhttp.send(null);
var json = JSON.parse(xmlhttp.responseText);
var time = json.map(item => item.timeStamp);
var value = json.map(item => item.value);

if(item.includes("binary")){dataSeries.type = "stepArea"}
for (var i = 0; i < time.length; i ++) {data1Points.push({x: time[i],y: value[i]});}
//data1Series.dataPoints = data1Points;data.push(data1Series);
}



function render() {
CanvasJS.addColorSet("abc",["#DDDF0E","#7698BF"]);
dataSeries.dataPoints = dataPoints;data.push(dataSeries);
data1Series.dataPoints = data1Points;data.push(data1Series);

var chart = new CanvasJS.Chart("chartContainer", {
 zoomEnabled: true,

 backgroundColor: "#000000",theme: "dark1",colorSet: "abc",fontColor: "#999999",
  axisX:{gridThickness: 1,gridColor: "#424949",lineThickness: 0,
   lineColor: "#000000",
   tickLength: 0,
   labelFontColor: "#999999",   
 },
   axisY:{gridThickness: 1,gridColor: "#424949",tickLength: 0,lineThickness: 0,
   lineColor: "#000000",
   labelFontColor: "#999999", 
 },
  data:data,
  legend:{
cursor: "crosshair",
fontSize: 16,
  itemclick: toggleDataSeries
  }
    ,toolTip:{enabled: true,borderThickness: 0},
    toolbar:{buttonBorderColor: "#424949"}
    });
chart.render();

document.addEventListener('keydown', function(e) {

    var axisX = chart.axisX[0];
    var viewportMin = axisX.get("viewportMinimum"),
        viewportMax = axisX.get("viewportMaximum"),
        interval = (viewportMax-viewportMin)/10;
        // 3000000;
    var newViewportMin, newViewportMax;

    if (e.keyCode == '38'|| e.keyCode =='34') {// up arrow    
      newViewportMin = viewportMin + interval;
      newViewportMax = viewportMax - interval;
    }
    else if (e.keyCode == '40'|| e.keyCode =='33') {// down arrow
      newViewportMin = viewportMin - interval;
      newViewportMax = viewportMax + interval;
    }
    else if (e.keyCode == '37') {// left arrow
      newViewportMin = viewportMin - interval;
      newViewportMax = viewportMax - interval;
    }
    else if (e.keyCode == '39') {// right arrow
      newViewportMin = viewportMin + interval;
      newViewportMax = viewportMax + interval;
    }

      chart.axisX[0].set("viewportMinimum", newViewportMin,true);
      chart.axisX[0].set("viewportMaximum", newViewportMax);

}, false);




 
function toggleDataSeries(e){
if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {e.dataSeries.visible = false;}else{e.dataSeries.visible = true;}
  chart.render();}
}


</script>
