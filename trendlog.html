<!DOCTYPE HTML>
<html>
<head>


<style>

</style>
<script>



window.onload = function () {
chartgenerate();
}

function chartgenerate(){
var item = document.getElementById("item").value;


var URL = String("https://amnon.dyndns.org/api/rest/v1/protocols/bacnet/local/objects/")+item+String("/trend?encode=json&dataOnly=true&limit=500");

    var xmlhttp = new XMLHttpRequest();
    xmlhttp.open("GET", URL, false);
    xmlhttp.setRequestHeader("Content-Type", "application/json");
    xmlhttp.setRequestHeader('Authorization','Basic YWRtaW46U3luY2VsZWN0MjkxMQ==');
    xmlhttp.send(null);
    var json = JSON.parse(xmlhttp.responseText);

var time = json.map(item => item.timeStamp);
var value = json.map(item => item.value);

var y = 0;var data = [];var dataSeries = { 
type: "line",xValueType: "dateTime",name: "OAT",showInLegend: true
};
var dataPoints = [];

for (var i = 0; i < time.length; i ++) {dataPoints.push({x: time[i],y: value[i]});}

dataSeries.dataPoints = dataPoints;
data.push(dataSeries);  


var chart = new CanvasJS.Chart("chartContainer", {
	zoomEnabled: true,
    data: data,

    	legend:{
		cursor: "pointer",
		fontSize: 16,
        itemclick: toggleDataSeries
	},
    	toolTip:{
		shared: true}
    });
function toggleDataSeries(e){
	if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
		e.dataSeries.visible = false;
	}
	else{
		e.dataSeries.visible = true;
	}
	chart.render();
}




chart.render();

}

</script>
<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script></head>
<body>
<div id="chartContainer" style="height: 400px; width: 100%;">
</div>

</body>
<form onchange="chartgenerate()">
  <label for="item">Point:</label>
  <select name="item" id="item">
    <option value="analog-input/101">analog-input/101 - OAT</option>
    <option value="analog-input/102">analog-input/102 - RMT</option>
    <option value="analog-input/103">analog-input/103 - Tank T</option>
    <option value="analog-input/104">analog-input/104 - Collector T</option>
    <option value="analog-input/105">analog-input/105 - Slab Lea</option>
    <option value="analog-input/106">analog-input/106 - Batt V</option>
    <option value="analog-input/107">analog-input/107 - Polypipe</option>
    <option value="binary-output/102">binary-output/102 - AC Unit</option>
    <option value="binary-output/103">binary-output/103 - Circ Pump</option>
    <option value="binary-output/104">binary-output/104 - DHW Boost</option>
    <option value="binary-output/105">binary-output/105 - Slab Circ</option>
    <option value="binary-output/106">binary-output/106 - Econfan</option>
    <option value="binary-output/108">binary-output/108 - Roof Louvre</option>
    <option value="analog-value/25">analog-value/25 - Watts</option>
    <option value="analog-value/26">analog-value/26 - Mains kWh</option>
    <option value="analog-value/28">analog-value/26 - Solar kWh</option>
 
  </select>
</form>
	<h4><a href="/homeautomation/index.html">Home</a></h4>
</html>
